@page "/managedata"
@inherits BaseComponent
@using Microsoft.EntityFrameworkCore
@using BlazorApp.Pages

<h3>Manage Data</h3>

@code {
    private AppDbContext _context;
    private List<Seller> users = new List<Seller>();
    private Seller editingUser;

    // Felter for at tilføje brugere.
    private string newUserName;
    private string newUserPhoneNumber;
    private string newUserEmail;
    private bool newUserTrusted;
    private int newUserProductId;

    // Tilføj bruger funktionen
    private void AddUser()
    {
        var newUser = new Seller
            {
                Name = newUserName,
                PhoneNumber = newUserPhoneNumber,
                Email = newUserEmail,
                Trusted = newUserTrusted,
                ProductId = newUserProductId
            };

        _context.Users.Add(newUser);
        _context.SaveChanges();

        // Opdater brugerlisten
        LoadUsers();
        ResetNewUserFields();
    }

    // Vis redigeringsformular
    private void EditUser(Seller user)
    {
        editingUser = user;
    }

    // Gem redigeret bruger
    private void SaveEditedUser()
    {
        _context.SaveChanges();
        editingUser = null;

        // Opdater brugerlisten
        LoadUsers();
    }

    // Fjern bruger
    private void RemoveUser(Seller user)
    {
        _context.Users.Remove(user);
        _context.SaveChanges();

        // Opdater brugerlisten
        LoadUsers();
    }

    // Nulstil felter for ny bruger
    private void ResetNewUserFields()
    {
        newUserName = string.Empty;
        newUserPhoneNumber = string.Empty;
        newUserEmail = string.Empty;
        newUserTrusted = false;
        newUserProductId = 0;
    }

    // Indlæs brugere fra databasen
    private void LoadUsers()
    {
        users = _context.Users.ToList();
    }

    // Inject AppDbContext
    [Inject]
    public AppDbContext Context
    {
        get => _context;
        set
        {
            _context = value;
            LoadUsers();
        }
    }
}
