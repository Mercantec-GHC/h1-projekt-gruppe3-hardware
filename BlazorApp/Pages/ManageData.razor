@page "/managedata"
@inherits BaseComponent
@using Microsoft.EntityFrameworkCore

<h3>Manage Data</h3>

@code {
    [Inject]
    private AppDbContext context { get; set; }

    private List<Seller> users = new List<Seller>();
    private Seller editingUser;

    // Felter for at tilføje brugere.
    private string newUserName;
    private string newUserPhoneNumber;
    private string newUserEmail;
    private bool newUserTrusted;
    private int newUserProductId;

    // Tilføj bruger funktionen
    private void AddUser()
    {
        var newUser = new Seller
            {
                Name = newUserName,
                PhoneNumber = newUserPhoneNumber,
                Email = newUserEmail,
                Trusted = newUserTrusted,
                ProductId = newUserProductId
            };

        context.Users.Add(newUser);
        context.SaveChanges();

        // Opdater brugerlisten
        LoadUsers();
        ResetNewUserFields();
    }

    // Vis redigeringsformular
    private void EditUser(Seller user)
    {
        editingUser = user;
    }

    // Gem redigeret bruger
    private void SaveEditedUser()
    {
        context.SaveChanges();
        editingUser = null;

        // Opdater brugerlisten
        LoadUsers();
    }

    // Fjern bruger
    private void RemoveUser(Seller user)
    {
        context.Users.Remove(user);
        context.SaveChanges();

        // Opdater brugerlisten
        LoadUsers();
    }

    // Nulstil felter for ny bruger
    private void ResetNewUserFields()
    {
        newUserName = string.Empty;
        newUserPhoneNumber = string.Empty;
        newUserEmail = string.Empty;
        newUserTrusted = false;
        newUserProductId = 0;
    }

    // Indlæs brugere fra databasen
    private void LoadUsers()
    {
        users = context.Users.ToList();
    }
}

<!-- Tilføj brugerformular -->
<h4>Add User</h4>
<form @onsubmit="AddUser">
    <label>Name: </label>
    <input @bind="newUserName" />
    <label>Phone Number: </label>
    <input @bind="newUserPhoneNumber" />
    <label>Email: </label>
    <input @bind="newUserEmail" />
    <label>Trusted: </label>
    <input type="checkbox" @bind="newUserTrusted" />
    <label>Product Id: </label>
    <input @bind="newUserProductId" />
    <button type="submit">Add User</button>
</form>

<!-- Vis eksisterende brugere -->
<h4>Users</h4>
@foreach (var user in users)
{
    <div>
        <span>@user.Name</span>
        <button @onclick="() => EditUser(user)">Edit</button>
        <button @onclick="() => RemoveUser(user)">Remove</button>
    </div>
}

<!-- Rediger brugerformular -->
@if (editingUser != null)
{
    <h4>Edit User</h4>
    <form @onsubmit="SaveEditedUser">
        <label>Name: </label>
        <input @bind="editingUser.Name" />
        <label>Phone Number: </label>
        <input @bind="editingUser.PhoneNumber" />
        <label>Email: </label>
        <input @bind="editingUser.Email" />
        <label>Trusted: </label>
        <input type="checkbox" @bind="editingUser.Trusted" />
        <label>Product Id: </label>
        <input @bind="editingUser.ProductId" />
        <button type="submit">Save Changes</button>
    </form>
}
